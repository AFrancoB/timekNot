// Generated by purs version 0.15.10
import * as Control_Category from "../Control.Category/index.js";
import * as Data_DateTime from "../Data.DateTime/index.js";
import * as Data_DateTime_Instant from "../Data.DateTime.Instant/index.js";
import * as Data_EuclideanRing from "../Data.EuclideanRing/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Newtype from "../Data.Newtype/index.js";
import * as Data_Rational from "../Data.Rational/index.js";
import * as Data_Semiring from "../Data.Semiring/index.js";
import * as Data_Time_Duration from "../Data.Time.Duration/index.js";
import * as Effect_Now from "../Effect.Now/index.js";
var unwrap = /* #__PURE__ */ Data_Newtype.unwrap();
var diff = /* #__PURE__ */ Data_DateTime.diff(Data_Time_Duration.durationMilliseconds);
var toRational = /* #__PURE__ */ Data_Rational.toRational(Data_Rational.toRationalInt);
var add1 = /* #__PURE__ */ Data_Semiring.add(Data_Rational.semiringRational);
var mul1 = /* #__PURE__ */ Data_Semiring.mul(Data_Rational.semiringRational);
var div1 = /* #__PURE__ */ Data_EuclideanRing.div(Data_Rational.euclideanRingRational);
var identity = /* #__PURE__ */ Control_Category.identity(Control_Category.categoryFn);
var adjust = /* #__PURE__ */ Data_DateTime.adjust(Data_Time_Duration.durationMilliseconds);
var fromJust = /* #__PURE__ */ Data_Maybe.fromJust();
var adjust1 = /* #__PURE__ */ Data_DateTime.adjust(Data_Time_Duration.durationSeconds);
var timeToCountNumber = function (x) {
    return function (t) {
        var timeDiff = unwrap(diff(t)(x.time));
        var df = (timeDiff * Data_Rational.toNumber(x.freq)) / 1000.0;
        return df + Data_Rational.toNumber(x.count);
    };
};
var timeToCount = function (x) {
    return function (t) {
        var d = unwrap(diff(t)(x.time));
        var d$prime = toRational(Data_Int.floor(d))(1000);
        return add1(mul1(d$prime)(x.freq))(x.count);
    };
};
var origin = function (x) {
    var increment = div1(mul1(x.count)(Data_Rational.fromInt(-1000 | 0)))(x.freq);
    return Data_Maybe.maybe(x.time)(identity)(adjust(Data_Rational.toNumber(increment))(x.time));
};
var newTempo = function (freq) {
    return function __do() {
        var time = Effect_Now.nowDateTime();
        return {
            freq: freq,
            time: time,
            count: Data_Rational.fromInt(0)
        };
    };
};
var fromForeignTempo = function (x) {
    var time = Data_DateTime_Instant.toDateTime(fromJust(Data_DateTime_Instant.instant(x.time)));
    var freq = toRational(x.freqNumerator)(x.freqDenominator);
    var count = toRational(x.countNumerator)(x.countDenominator);
    return {
        freq: freq,
        time: time,
        count: count
    };
};
var countToTime = function (x) {
    return function (c) {
        return Data_Maybe.maybe(x.time)(identity)(adjust1(Data_Rational.toNumber(div1(c)(x.freq)))(origin(x)));
    };
};
export {
    newTempo,
    origin,
    timeToCount,
    timeToCountNumber,
    countToTime,
    fromForeignTempo
};
